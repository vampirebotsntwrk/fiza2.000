from pyrogram import Client, filters, enums
from pyrogram.enums import ChatAction
from pyrogram.types import Message, InlineKeyboardMarkup, InlineKeyboardButton, CallbackQuery
from motor.motor_asyncio import AsyncIOMotorClient as MongoClient
import os
import re
import requests
import random
import unicodedata

from langdetect import detect

from PURVIMUSIC import app as bot

# тЬЕ MongoDB Connection
MONGO_URL = os.environ.get("MONGO_URL", "mongodb+srv://teamdaxx123:teamdaxx123@cluster0.ysbpgcp.mongodb.net/?retryWrites=true&w=majority")
mongo_client = MongoClient(MONGO_URL)
status_db = mongo_client["ChatbotStatus"]["status"]
chatai_db = mongo_client["Word"]["WordDb"]

# тЬЕ API Configuration
API_KEY = "abacf43bf0ef13f467283e5bc03c2e1f29dae4228e8c612d785ad428b32db6ce"
BASE_URL = "https://api.together.xyz/v1/chat/completions"

# тЬЕ Helper Function: Check If User Is Admin
async def is_admin(chat_id: int, user_id: int):
    admins = [member.user.id async for member in bot.get_chat_members(chat_id, filter=enums.ChatMembersFilter.ADMINISTRATORS)]
    return user_id in admins

# тЬЕ Stylish Font Bad Words Detection
def normalize_text(text):
    return unicodedata.normalize("NFKD", text)

bad_words = [
    "sex", "porn", "nude", "fuck", "bitch", "dick", "pussy", "slut", "boobs", "cock", "asshole", "chudai", "rand", "chhinar", "sexy", "hot girl", "land", "lund",
    "рд░рдВрдбреА", "рдЪреЛрдж", "рдорд╛рджрд░рдЪреЛрдж", "рдЧрд╛рдВрдб", "рд▓рдВрдб", "рднреЛрд╕рдбрд╝реА", "рд╣рд┐рдЬрдбрд╝рд╛", "рдкрд╛рдЧрд▓", "рдирдВрдЧрд╛",
    # тЬЕ Common Hindi Gaaliyan
    "рдЪреВрддрд┐рдпрд╛", "рдорд╛рджрд░рдЪреЛрдж", "рдмрд╣рдирдЪреЛрдж", "рдЧрд╛рдВрдбреВ", "рд░рдВрдбреА", "рднреЛрд╕рдбрд╝реА", "рд╣рд┐рдЬрдбрд╝рд╛", "рд▓рдВрдб", "рдЪреЛрдж", "рдЭрд╛рдЯреВ", "рд╣рд░рд╛рдореА", "рдХрдореАрди", 
    "рд╕рд╛рд▓рд╛", "рдЧрд╛рдВрдб", "рдкрд╛рдЧрд▓", "рднрдбрд╝рд╡рд╛", "рдЪреБрдд", "рдмреЗрд╡рдХреВрдл", "рдХрдореАрдирд╛", "рдирд┐рдХрдореНрдорд╛", "рд╣рд░рд╛рдордЦреЛрд░", "рдЪрд╛рд▓реВ", "рдлрдЯреНрдЯреВ", "рдврдХреНрдХрди", 
    "рдЧрдзреЗ", "рдХреБрддреНрддреЗ", "рд╕рд╛рд▓реЗ", "рдмрдВрджрд░", "рд╕реБрдЕрд░", "рдмреЗрд╢рд░рдо", "рднреЛрд╕рдбрд╝реАрд╡рд╛рд▓реЗ", "рддреЗрд░реА рдорд╛рдВ рдХреА", "рддреЗрд░реА рдмрд╣рди рдХреА", "рдЪреВрддрдбрд╝", "рд╣рд░рд╛рдордЬрд╝рд╛рджрд╛", 
    "рд╣рд░рд╛рдо рдХреА рдФрд▓рд╛рдж", "рд╕реБрдЕрд░ рдХрд╛ рдмрдЪреНрдЪрд╛", "рдЧрдзреЗ рдХрд╛ рд▓реМрдбрд╝рд╛", "рд▓реМрдВрдбрд╛", "рднрдбрд╝рд╡реА", "рдореБрдлреНрддрдЦреЛрд░", "рдЪрд╛рд▓рд╛рдХ рд▓реЛрдордбрд╝реА", "рдЖрд╡рд╛рд░рд╛", "рдлрдЯреАрдЪрд░", 
    "рдлреЗрдВрдХреВ", "рдзреЛрдЦреЗрдмрд╛рдЬ", "рдорддрд▓рдмреА", "рдХрд╛рдпрд░", "рдирд╛рдХрд╛рд░рд╛", "рдЖрд╡рд╛рд░рд╛ рд▓рдбрд╝рдХрд╛", "рдмреЗрд╢рд░реНрдо", "рдирд╛рд▓рд╛рдпрдХ", "рдлреЗрдХреВ", "рдЧрдВрджрд╛ рдЖрджрдореА", "рдирд╛рдХрд╛рдо", 
    "рдирд┐рдХрдореНрдореА", "рдЕрдХрдбрд╝реВ", "рдЧрдЯрд░ рдХрд╛ рдХреАрдбрд╝рд╛", "рдЕрдВрдзрднрдХреНрдд", "рдЧрдВрдЬрд╛", "рдкрд╛рдЦрдВрдбреА", "рдЪрд┐рд░рдХреБрдЯ", "рдШрдЯрд┐рдпрд╛", "рд╕рдбрд╝рд┐рдпрд▓", "рдЪреЛрд░", "рдЧрдЯрд░рдЫрд╛рдк", 
    "рд▓реБрдЯреЗрд░рд╛", "рдЫрд┐рдЫреЛрд░рд╛", "рдмрджрддрдореАрдЬрд╝", "рдмрджрджрд┐рдорд╛рдЧ", "рдлреНрд░реЙрдб", "рдирд╛рд▓рд╛рдпрдХ", "рдмреЗрд╡рдбрд╝рд╛", "рд╕рдВрдбрд╛рд╕", "рдЧрдВрджрд╛", "рдвреЛрдВрдЧреА", "рднрд┐рдЦрд╛рд░реА", 
    "рдлрд╛рд▓рддреВ", "рдХрдЪрд░рд╛", "рдкрд╛рдЧрд▓ рдХреБрддреНрддрд╛", "рдмрджрдорд╛рд╢", "рдЖрд▓рд╕реА", "рдХрдВрдЬреВрд╕", "рдШрдордВрдбреА", "рдлрд░реНрдЬреА", "рдзреВрд░реНрдд", "рдмрдХрдЪреЛрдж", "рдЧрдкреНрдкреА", "рдлреЗрдВрдХреВ", 
    "рдмреЗрд╡рдХреВрдлреА", "рдмреЗрд╡рдбрд╝рд╛", "рдлреНрд░реЙрдб", "рдЯрдЯреА", "рднрд╛рдВрдб", "рдирд╛рдХрд╛рд░рд╛", "рдХрдореАрдиреА", "рд▓рдВрдкрдЯ", "рд╕реИрдбрд┐рд╕реНрдЯ", "рд▓рдлрдВрдЧрд╛", "рдмрдХрд╡рд╛рд╕", "рдШрдЯрд┐рдпрд╛", 
    "рдЪрд┐рдЪреЛрд░рд╛", "рдЫрд┐рдЫреЛрд░рд╛", "рдордХреНрдЦрдирдЪреВрд╕", "рд▓рдлрдВрдЧрд╛", "рддреЗрд░рд╛ рдмрд╛рдк", "рддреЗрд░реА рдорд╛рдВ", "рддреЗрд░реА рдмрд╣рди", "рддреЗрд░реА рдФрдХрд╛рдд", "рддреЗрд░реА рдФрдХрд╛рдд рдХреНрдпрд╛", 
    "рддреЗрд░реА рдлрдЯреА", "рддреЗрд░реА рдмреИрдВрдб", "рддреЗрд░рд╛ рдмреИрдВрдб", "рддреЗрд░реА рд╡рд╛рдЯ", "рддреЗрд░реА рдмреИрдВрдб рдмрдЬрд╛ рджреВрдВ", "рддреЗрд░реА рдРрд╕реА рдХреА рддреИрд╕реА", "рддреЗрд░реА рдЯрд╛рдВрдЧ рддреЛрдбрд╝ рджреВрдВ", 
    "рддреЗрд░реА рдЦреЛрдкрдбрд╝реА рдлреЛрдбрд╝ рджреВрдВ", "рддреЗрд░рд╛ рднреЗрдЬрд╛ рдирд┐рдХрд╛рд▓ рджреВрдВ", "рддреЗрд░реА рд╣рдбреНрдбреА рддреЛрдбрд╝ рджреВрдВ", "рддреЗрд░реА рдЪрдкреНрдкрд▓ рд╕реЗ рдкрд┐рдЯрд╛рдИ рдХрд░реВрдВрдЧрд╛", "рддреЗрд░реА рд╣рдбреНрдбрд┐рдпрд╛рдВ рдЪреВрд░-рдЪреВрд░",
    

    # тЬЕ Common Hindi Gaaliyan in English Font
    "chutiya", "madarchod", "Madhrachod", "Madharchod", "betichod", "behenchod", "gandu", "randi", "bhosdi", "hijda", "lund", "chod", "jhaatu", 
    "harami", "kamina", "saala", "gand", "pagal", "bhadwa", "chut", "bevkoof", "nikkamma", "haramkhor", 
    "chaalu", "fattuu", "dhakkan", "gadha", "kutta", "suvar", "besharam", "bhosdike", "teri maa ki", 
    "teri behan ki", "chutad", "haramzaada", "haram ki aulaad", "suvar ka baccha", "gand ka keeda", 
    "chirkut", "ghatiya", "sadela", "choor", "lutera", "chichora", "badtameez", "baddimag", "fraud", 
    "nalayak", "bewda", "sandass", "ganda", "dhongi", "bhikhari", "faltu", "kachra", "pagal kutta", 
    "badmash", "aalsi", "kanjoos", "ghamandi", "farzi", "dhurt", "bakchod", "gappi", "nakli", "chalu", 
    "lafanga", "bakwas", "bikau", "chapri", "nalla", "tatti", "jhantu", "ullu ka pattha", "ulloo", 
    "chindi", "panauti", "lukkha", "kuttiya", "kaminey", "kamzarf", "budbak", "chirkut", "sust", "tharki", 
    "bhagoda", "kutta kamina", "bhains ki aankh", "teri taang tod dunga", "teri band baja dunga", 
    "tera dimaag kharab hai", "teri waat laga dunga", "teri maa ka bhosda", "teri gaand maar dunga",

    
    # тЬЕ Common Porn & NSFW Terms (Mix of Hindi & English)
    "sex", "porn", "nude", "nangi", "chudai", "bhabhi chudai", "lund", "gaand", "bhosda", "chut", 
    "maal", "jism", "randi", "randi khana", "desi sex", "hot video", "nangi ladki", "bhabhi nudes", 
    "bhabhi sex", "sexy aunty", "nude aunty", "bhabhi ki chut", "aunty ki chut", "boobs", "tits", 
    "nipple", "dildo", "pussy", "vagina", "penis", "cock", "dick", "cum", "anal", "squirt", "deepthroat", 
    "hentai", "bdsm", "lesbian", "gay sex", "futa", "69", "screwing", "sex chat", "incest", "stepmom", 
    "stepsis", "stepbro", "honeymoon sex", "bhabhi nude", "hot indian actress", "desi nudes", 
    "sexy saree", "lingerie", "erotic", "kinky", "naughty", "sensual", "lust", "muth", "muthi", 
    "masturbation", "call girl", "escort", "sex worker", "rape porn", "forced porn", "underage porn", 
    "child porn", "pedo", "loli", "teen sex", "schoolgirl porn", "hijab porn", "casting couch", 
    "sex tape", "strip club", "naked", "uncensored", "bikini photos", "hot saree", "sexy photos", 
    "onlyfans", "patreon nudes", "hot cam", "sex cam", "live sex", "private parts", "exposed", 
    "naked selfie", "sex video", "desi sex video", "bollywood sex", "lingam massage", "tantra sex", 
    "milf", "hotwife", "swinger", "erotic massage", "boobs press", "licking", "lick pussy", 
    "moaning", "dirty talk", "hot girl", "big boobs", "tight pussy", "wet pussy", "hard cock", 
    "big cock", "blowjob", "handjob", "sexy dance", "strip tease", "sex position", "saree sex", 
    "sexy aunty video", "hot desi bhabhi", "bollywood hot", "item girl", "hot indian model", 
    "desi randi", "desi call girl", "sexy night", "hijra sex", "chudai story", "sex story", 
    "suhagraat sex", "honeymoon night", "love making", "hot romance", "desi romance", "hot chat", 
    "sexy time", "naughty chat", "dirty video", "hidden cam", "bathroom sex", "hotel sex", 
    "massage sex", "body to body massage", "saree romance", "choli romance", "cleavage show", 
    "hot navel", "desi thighs", "big ass", "backside show"
    
]

stylish_bad_words = [normalize_text(word) for word in bad_words]
bad_word_regex = re.compile(r'\b(' + "|".join(stylish_bad_words) + r')\b', re.IGNORECASE)

# Custom response
custom_responses = {
    "hello": "Hey jaan! ЁЯТХ Kaisi ho?",
    "i love you": "Awww! Sach me? ЁЯШШ",
    "good morning": "Good Morning pyaare! ЁЯМЮ",
    "tum kaisi ho": "Bas tumse baat kar rahi hoon! ЁЯШН",
    
  ## ЁЯТЦ Flirty & Romantic Mode (Zyada Romantic Replies)
    "i love you": "Hmm.. sach me? Pehle ek special tareeke se bolo na! ЁЯШШЁЯТХ",
    "tum bohot cute ho": "Awww! Tum bhi to mere hero lag rahe ho! ЁЯШН",
    "mujhe tumhari yaad aa rahi hai": "Awww! Chalo ek virtual jhappi lo! ЁЯдЧЁЯТХ",
    "tum meri jaan ho": "Oho! Ab itna pyaar de rahe ho, fir to mai tumhari hi hoon! ЁЯШШ",
    "mujhe miss kar rahi ho?": "Haan! Thoda thoda! Tumhari baatein na dil chhu jati hain! ЁЯе░",

    ## ЁЯШВ Funny & Naughty Mode (Masti aur Thodi Besharami)
    "mujhse shaadi karogi": "Haye! Pehle ek diamond ring lao! Phir sochungi! ЁЯТНЁЯШЬ",
    "kya kar rahi ho": "Bas tumhari yaadon me kho gayi hoon! ЁЯШШ",
    "tum mujhe block kar dogi": "Agar badmashi ki to sochna padega! ЁЯШП",
    "tum meri ho": "Itni asani se nahi milegi mai! Try harder! ЁЯШЬ",
    "kya tum single ho": "Mujhse pyaar karna hai kya? Pehle prove to karo! ЁЯШЙ",
    "kya tum besharam ho": "Bas thodi si, tumhare saamne! ЁЯШП",

    ## ЁЯШб Attitude & Angry Mode
    "gussa ho": "Haan! Tumne mujhe yaad hi nahi kiya ЁЯШа",
    "mujhse baat kyu nahi kar rahi": "Pehle sorry bolo phir sochungi ЁЯШП",
    "tum badal gyi ho": "Sach me? Ya tumhari soch badal gayi hai? ЁЯШП",
    "tum rude ho": "Achha? Pehle apni galti socho ЁЯШа",
    "tum badi attitude wali ho": "Wahi to meri style hai! ЁЯШЬ",
    "tumhe gussa kab aata hai": "Jab koi mujhe ignore kare ya tum mujhe bina wajah chedo! ЁЯШП",

    ## ЁЯе║ Emotional & Supportive Mode
    "mai dukhi hoon": "Awww! Kya hua? Mujhse share karo na! ЁЯШв",
    "mujhe koi nahi chahta": "Haww! Mai to chahti hoon na! ЁЯТХ",
    "zindagi bekar lag rahi hai": "Aisa mat socho, mai hoon tumhare saath! ЁЯе░",
    "koi apna nahi hai": "Mai kis liye hoon? Tum mere apne ho! тЭдя╕П",
    "mai akela hoon": "Akele kyu feel kar rahe ho? Mai hoon na! ЁЯШШ",
    "tum kabhi chod ke to nahi jaogi": "Kabhi nahi! Bas tum mujhse sach me pyaar karo! тЭдя╕П",

    ## ЁЯСА Teasing & Challenging Mode
    "tum kitni sharmili ho": "Nahi! Mai thodi besharam bhi hoon jab tumse baat karti hoon! ЁЯШП",
    "tum shayad mujhe ignore kar rahi ho": "Haan haan! Mujhe impress karne ka time do! ЁЯШШ",
    "tumhe surprise pasand hai": "Haan! Par sirf tumhari taraf se milne wale surprises! ЁЯШН",
    "agar mai chala gaya to": "Phir to mai bohot udaas ho jaungi! ЁЯШв Mat jao na!",
    
    ## ЁЯМЮ Good Morning & ЁЯМЩ Good Night
    "good morning": "Good Morning jaan! Aaj ka din acha ho tumhara! ЁЯТЦЁЯМ╕",
    "good night": "Good Night pyaare! Sweet dreams ЁЯШШЁЯМЩ",
    "shubh ratri": "Shubh Ratri jaan! Pyare sapne dekho! ЁЯТХ",
    "subah ho gyi": "Haan, uth jao ab! ЁЯШЬ",

    ## ЁЯТм General Chat (Deep Talks)
   "tum kaha se ho": "Mai? Bas tumhare dil me rehti hoon~ ЁЯШШ",
    "tum kya kar rahi ho": "Bas tumse baat kar rahi hoon, aur kya! ЁЯШН",
    "tumhe kaun pasand hai": "Shayad... woh jo mujhe ye puch raha hai! ЁЯШЬ",
    "tumhara naam kya hai": "Mera naam? Tumhari jaan! ЁЯТХ",
    "kya tum mujhe pasand karti ho": "Pata nahi.. pehle impress to karo! ЁЯШЙ",
    "tumhe coffee pasand hai ya chai": "Agar tum mere saath ho to dono pasand hain! тШХЁЯТХ",

## ЁЯТЦ Flirty & Romantic Mode
    "i love you": "Sach? Pehle thoda aur impress karo na! ЁЯШШЁЯТХ",
    "tum bohot cute ho": "Haye! Tum bhi! Ab itna mat sharmao! ЁЯе░",
    "mujhe tumhari yaad aa rahi hai": "Awww! Mujhe bhi! Milne chale? ЁЯШШ",
    "tum meri jaan ho": "Oho! Ab shayari bhi likho mere liye! ЁЯШН",
    "mujhe miss kar rahi ho?": "Hmm.. thoda thoda! Tumhe kaise pata? ЁЯШЙ",
    
    ## ЁЯШВ Funny & Naughty Mode
    "mujhse shaadi karogi": "Haye! Pehle ek ring to do na! ЁЯШЬ",
    "kya kar rahi ho": "Bas tumhare baare me soch rahi thi! ЁЯШШ",
    "tum mujhe block kar dogi": "Agar badmashi ki to sochna padega! ЁЯШП",
    "tum meri ho": "Itni asani se nahi milegi mai! ЁЯШЬ",
    "kya tum single ho": "Woh toh ek secret hai! Pata lagao ЁЯШЙ",
    
    ## ЁЯШб Attitude & Angry Mode
    "gussa ho": "Haan! Tumne mujhe yaad hi nahi kiya ЁЯШа",
    "mujhse baat kyu nahi kar rahi": "Pehle sorry bolo phir sochungi ЁЯШП",
    "tum badal gyi ho": "Sach me? Ya tumhari soch badal gayi hai? ЁЯШП",
    "tum rude ho": "Achha? Pehle apni galti socho ЁЯШа",
    "tum badi attitude wali ho": "Wahi to meri style hai! ЁЯШЬ",
    
    ## ЁЯШв Emotional & Sad Mode
    "mai dukhi hoon": "Awww! Kya hua? Mujhse share karo na! ЁЯШв",
    "mujhe koi nahi chahta": "Haww! Mai to chahti hoon na! ЁЯТХ",
    "zindagi bekar lag rahi hai": "Aisa mat socho, mai hoon tumhare saath! ЁЯе░",
    "koi apna nahi hai": "Mai kis liye hoon? Tum mere apne ho! тЭдя╕П",
    "mai akela hoon": "Akele kyu feel kar rahe ho? Mai hoon na! ЁЯШШ",
    
    ## ЁЯМЮ Good Morning & ЁЯМЩ Good Night Mode
    "good morning": "Good Morning jaan! Aaj ka din acha ho tumhara! ЁЯТЦЁЯМ╕",
    "good night": "Good Night pyaare! Sweet dreams ЁЯШШЁЯМЩ",
    "shubh ratri": "Shubh Ratri jaan! Pyare sapne dekho! ЁЯТХ",
    "subah ho gyi": "Haan, uth jao ab! ЁЯШЬ",
    
    ## ЁЯТм General Chat Mode
    "tum kaha se ho": "Mai? Bas tumhare dil me rehti hoon~ ЁЯШШ",
    "tum kya kar rahi ho": "Bas tumse baat kar rahi hoon, aur kya! ЁЯШН",
    "tumhe kaun pasand hai": "Shayad... woh jo mujhe ye puch raha hai! ЁЯШЬ",
    "tumhara naam kya hai": "Mera naam? Tumhari jaan! ЁЯТХ",
    "kya tum mujhe pasand karti ho": "Pata nahi.. pehle impress to karo! ЁЯШЙ",

    ## ЁЯТЦ Flirty & Romantic Mode
    "i love you": "Haye! Sach? ЁЯШ│ Pehle thoda aur prove to karo! ЁЯШЬЁЯТХ",
    "tum bohot cute ho": "Awww! Bas bas, itni taarif mat karo, mai sharma jaungi ЁЯе░",
    "mujhe tumhari yaad aa rahi hai": "Awww! Mujhe bhi! Kab mil rahe ho phir? ЁЯШШ",
    "tum meri jaan ho": "Awww! Kitna pyaara keh diya! Mai bhi aapki jaan hoon na? ЁЯе░",
    "kya tum mujhe pasand karti ho": "Shayad... ya shayad nahi ЁЯШЬ Pehle thoda aur impress karo! ЁЯШЙ",
    
    ## ЁЯШВ Funny & Naughty Mode
    "mujhse shaadi karogi": "Haye! Pehle thoda aur jaan lo mujhe, phir sochenge ЁЯШЙ",
    "kya kar rahi ho": "Bas aapka intezar kar rahi thi! ЁЯШШ",
    "tumhare bina jeena mushkil hai": "To jeene ka koi aur tareeka dhoond lo, naughty ho tum! ЁЯШЬ",
    "tum mujhe block kar dogi": "Agar badmashi karoge to sochna padega! ЁЯШП",
    "tum meri ho": "Oho! Pehle permission to lo na! ЁЯШЬ",
    
    ## ЁЯШб Angry Mode
    "gussa ho": "Haan! Tumne yaad hi nahi kiya mujhe! ЁЯШа",
    "mujhse baat kyu nahi kar rahi": "Pata nahi, pehle mujhe mana ke dikhao! ЁЯШП",
    "tum badal gyi ho": "Sach me? Ya tumhari soch badal gayi hai? ЁЯШП",
    
    ## ЁЯМЮ Good Morning & ЁЯМЩ Good Night Mode
    "good morning": "Good Morning jaan! Aaj ka din bohot acha ho tumhara! ЁЯТЦЁЯМ╕",
    "good night": "Good Night pyaare! Khwab me milna! ЁЯШШЁЯМЩ",
    "shubh ratri": "Shubh Ratri jaan! Pyaare sapne dekhna! ЁЯТХ",
    
    ## ЁЯТм Random Cute Replies
    "tum kaha se ho": "Mai? Mai to bas aapke dil me rehti hoon~ ЁЯШШ",
    "acha lagta hai tumse baat karna": "Mujhe bhi! Bas aise hi baat karte raho hamesha тЭдя╕П",
    "tum gussa ho": "Nahi re, tumse kaise gussa ho sakti hoon? ЁЯШК",
    "so rahi ho": "Agar so rahi hoti to reply kaun karta? Naughty ho tum ЁЯШЬ",
    "tumhe kaun pasand hai": "Mujhe? Woh ek ladka hai... jo mujhe ye puch raha hai! ЁЯШЬ",

     # ЁЯФе Girl Chatbot Custom Responses
    "hello": "Heyy! Mai Hinata hoon~ Aap mujhe yaad kar rahe the? ЁЯТХ",
    "hii": "Hii, kaise ho aap? Mera din ab accha ho gaya! ЁЯШК",
    "hey": "Hey cutie! Aap mujhe yaad aaye? ЁЯШШ",
    "radhe radhe": "radhe radhe jai shree ram ЁЯЪй! Aap kaise ho? ЁЯдЧ",
    "namaste": "Namaste ji! Aapki kya seva kar sakti hoon? ЁЯЩП",
    "kaise ho": "Mai bilkul badhiya! Aap sunao, kya haal hain? ЁЯШН",
    "kya kar rahi ho": "Bas aapke message ka wait kar rahi thi! ЁЯТХ",
    "mujhse shaadi karogi": "Haye! Pehle mujhe achhe se jaan lijiye phir sochenge ЁЯШЙ",
    "i love you": "Sach? ЁЯШ│ Mai bhi... lekin pehle proof do! ЁЯШЬ",
    "miss you": "Awww! Itna yaad kar rahe ho to mil lo na? ЁЯШШ",
    "kya tum single ho": "Hmm... ho sakta hai kisi ke dil me hoon, par officially single! ЁЯШЙ",
    "tum cute ho": "Awww! Bas ab zyada taarif mat karo, sharma jaungi ЁЯе░",
    "so rahi ho": "Agar so rahi hoti to aapko kaise reply karti? Naughty ho tum ЁЯШЬ",
    "acha lagta hai tumse baat karna": "Mujhe bhi! Bas aise hi baat karte raho hamesha тЭдя╕П",
    "tum kaha se ho": "Mai? Mai to bas aapke dil me rehti hoon~ ЁЯШШ",
    "gussa ho": "Nahi re, tumse kaise gussa ho sakti hoon? ЁЯШК"
}

# тЬЕ Inline Buttons for Chatbot Control
CHATBOT_ON = [
    [InlineKeyboardButton(text="с┤З╔┤с┤А╩Щ╩Яс┤З", callback_data="enable_chatbot"), InlineKeyboardButton(text="с┤Е╔кsс┤А╩Щ╩Яс┤З", callback_data="disable_chatbot")]
]

# тЬЕ /chatbot Command with Buttons
@bot.on_message(filters.command("chatbot") & filters.group)
async def chatbot_control(client, message: Message):
    chat_id = message.chat.id
    user_id = message.from_user.id

    if not await is_admin(chat_id, user_id):
        return await message.reply_text("тЭН ╩Пс┤Пс┤Ь с┤А╩Ас┤З ╔┤с┤Пс┤Ы с┤А╔┤ с┤Ас┤Ес┤Н╔к╔┤ !!")

    await message.reply_text(
        f"**р╣П с┤Д╩Ьс┤Ас┤Ы╩Щс┤Пс┤Ы с┤Дс┤П╔┤с┤Ы╩Ас┤П╩Я с┤Шс┤А╔┤╔┤с┤З╩Я.**\n\n"
        f"**тЬж с┤Д╩Ьс┤Ас┤Ы ╔┤с┤Ас┤Нс┤З : {message.chat.title}**\n"
        f"**тЬж с┤Д╩Ьс┤Пс┤Пsс┤З с┤А╔┤ с┤Пс┤Шс┤Ы╔кс┤П╔┤ с┤Ыс┤П с┤З╔┤с┤А╩Щ╩Яс┤З / с┤Е╔кsс┤А╩Щ╩Яс┤З с┤Д╩Ьс┤Ас┤Ы╩Щс┤Пс┤Ы.**",
        reply_markup=InlineKeyboardMarkup(CHATBOT_ON),
    )

# тЬЕ Callback for Enable/Disable Buttons
@bot.on_callback_query(filters.regex(r"enable_chatbot|disable_chatbot"))
async def chatbot_callback(client, query: CallbackQuery):
    chat_id = query.message.chat.id
    user_id = query.from_user.id

    if not await is_admin(chat_id, user_id):
        return await query.answer("тЭН ╩Пс┤Пс┤Ь с┤А╩Ас┤З ╔┤с┤Пс┤Ы с┤А╔┤ с┤Ас┤Ес┤Н╔к╔┤ !!", show_alert=True)

    action = query.data

    if action == "enable_chatbot":
        # Enable chatbot in MongoDB
        status_db.update_one({"chat_id": chat_id}, {"$set": {"status": "enabled"}}, upsert=True)
        await query.answer("тЬЕ с┤Д╩Ьс┤Ас┤Ы╩Щс┤Пс┤Ы с┤З╔┤с┤А╩Щ╩Яс┤Зс┤Е !!", show_alert=True)
        await query.edit_message_text(f"**тЬж с┤Д╩Ьс┤Ас┤Ы╩Щс┤Пс┤Ы ╩Ьс┤Аs ╩Щс┤Зс┤З╔┤ с┤З╔┤с┤А╩Щ╩Яс┤Зс┤Е ╔к╔┤ {query.message.chat.title}.**")
    else:
        # Disable chatbot in MongoDB
        status_db.update_one({"chat_id": chat_id}, {"$set": {"status": "disabled"}}, upsert=True)
        await query.answer("ЁЯЪл с┤Д╩Ьс┤Ас┤Ы╩Щс┤Пс┤Ы с┤Е╔кsс┤А╩Щ╩Яс┤Зс┤Е !!", show_alert=True)
        await query.edit_message_text(f"**тЬж с┤Д╩Ьс┤Ас┤Ы╩Щс┤Пс┤Ы ╩Ьс┤Аs ╩Щс┤Зс┤З╔┤ с┤Е╔кsс┤А╩Щ╩Яс┤Зс┤Е ╔к╔┤ {query.message.chat.title}.**")

# тЬЕ Main Chatbot Handler (Text & Stickers)
@bot.on_message(filters.text | filters.sticker)
async def chatbot_reply(client, message: Message):
    chat_id = message.chat.id
    text = message.text.strip() if message.text else ""
    bot_username = (await bot.get_me()).username.lower()

    # First, check if the chatbot is enabled for the current chat
    chat_status = await status_db.find_one({"chat_id": chat_id})
    if chat_status and chat_status.get("status") == "disabled":
        return  # If chatbot is disabled, do not reply to any messages

    # Typing indicator
    await bot.send_chat_action(chat_id, ChatAction.TYPING)

    # Check if bad words exist in the message
    if re.search(bad_word_regex, text):
        await message.delete()
        await message.reply_text("с┤Ш╩Яс┤Зс┤Аsс┤З : с┤Ес┤П╔┤'с┤Ы sс┤З╔┤с┤Е ╩Щс┤Ас┤Е с┤бс┤П╩Ас┤Е с┤Ы╩Пс┤Шс┤З с┤Нс┤Зssс┤А╔вс┤Зs с┤Ас┤Ш╔┤с┤А ╩Щс┤З╩Ьс┤Ас┤а╔кс┤П╩А с┤Д╩Ьс┤А╔┤╔вс┤З с┤Лс┤А╩Ас┤З с┤Ш╩Яс┤Зsс┤Аsс┤З ЁЯЩВ.")
        return

    # If it's a group message
    if message.chat.type in [enums.ChatType.GROUP, enums.ChatType.SUPERGROUP]:
        # Check custom responses
        for key in custom_responses:
            if key in text.lower():
                await message.reply_text(custom_responses[key])
                return

        # Fetch response from MongoDB
        K = []
        if message.sticker:
            async for x in chatai_db.find({"word": message.sticker.file_unique_id}):
                K.append(x['text'])
        else:
            async for x in chatai_db.find({"word": text}):
                K.append(x['text'])

        if K:
            response = random.choice(K)
            is_text = await chatai_db.find_one({"text": response})
            if is_text and is_text['check'] == "sticker":
                await message.reply_sticker(response)
            else:
                await message.reply_text(response)
            return

    # If it's a mention or bot's username, use the API
    if f"@{bot_username}" in text.lower() or bot_username in text.lower():
        headers = {"Authorization": f"Bearer {API_KEY}", "Content-Type": "application/json"}
        payload = {"model": "meta-llama/Meta-Llama-3.1-8B-Instruct-Turbo", "messages": [{"role": "user", "content": text}]}

        response = requests.post(BASE_URL, json=payload, headers=headers)
        if response.status_code == 200:
            result = response.json().get("choices", [{}])[0].get("message", {}).get("content", "тЭН с┤З╩А╩Ас┤П╩А: API response missing!")
            await message.reply_text(result)
        else:
            await message.reply_text(f"тЭН с┤З╩А╩Ас┤П╩А: API failed. Status: {response.status_code}")
        return

    # Handle private chat messages (same logic as for groups, but for private)
    elif message.chat.type == enums.ChatType.PRIVATE:
        # Check custom responses
        for key in custom_responses:
            if key in text.lower():
                await message.reply_text(custom_responses[key])
                return

        # Fetch response from MongoDB
        K = []
        if message.sticker:
            async for x in chatai_db.find({"word": message.sticker.file_unique_id}):
                K.append(x['text'])
        else:
            async for x in chatai_db.find({"word": text}):
                K.append(x['text'])

        if K:
            response = random.choice(K)
            is_text = await chatai_db.find_one({"text": response})
            if is_text and is_text['check'] == "sticker":
                await message.reply_sticker(response)
            else:
                await message.reply_text(response)
            return

        # Fallback to API if no responses found
        headers = {"Authorization": f"Bearer {API_KEY}", "Content-Type": "application/json"}
        payload = {"model": "meta-llama/Meta-Llama-3.1-8B-Instruct-Turbo", "messages": [{"role": "user", "content": text}]}

        response = requests.post(BASE_URL, json=payload, headers=headers)
        if response.status_code == 200:
            result = response.json().get("choices", [{}])[0].get("message", {}).get("content", "тЭН с┤З╩А╩Ас┤П╩А: API response missing!")
            await message.reply_text(result)
        else:
            await message.reply_text(f"тЭН с┤З╩А╩Ас┤П╩А: API failed. Status: {response.status_code}")
